<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Ultimate MC Resource Pack Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: #e0e0e0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background: #1e1e1e; padding: 30px; border-radius: 15px; width: 90%; max-width: 600px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .item-row { background: #2a2a2a; margin: 10px 0; padding: 15px; border-radius: 8px; border-left: 5px solid #3498db; position: relative; }
        input[type="file"] { margin-bottom: 10px; }
        .controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        button { cursor: pointer; border: none; border-radius: 5px; font-weight: bold; transition: 0.2s; }
        .btn-add { background: #2ecc71; color: white; padding: 10px 20px; margin-bottom: 20px; }
        .btn-generate { background: #3498db; color: white; padding: 15px; width: 100%; font-size: 1.1em; }
        .btn-remove { background: #e74c3c; color: white; padding: 5px 10px; font-size: 0.8em; }
        select, input[type="text"] { background: #333; color: white; border: 1px solid #444; padding: 5px; border-radius: 4px; }
        .char-code { color: #f1c40f; font-family: monospace; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>Generator Ikon & Fontów</h1>
    <p>Dodaj obrazki, a ja przypiszę im kody do gry.</p>
    
    <button class="btn-add" onclick="addRow()">+ Dodaj kolejny obrazek</button>
    
    <div id="items-list">
        </div>

    <button class="btn-generate" onclick="buildPack()">GENERUJE PACZKĘ .ZIP</button>
    
    <p style="font-size: 0.8em; color: #888; margin-top: 15px;">
        Wersja: 1.21.8 | Format: 34 | Folder: assets/minecraft/font
    </p>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
let rowCount = 0;

// Funkcja dodająca nowy wiersz dla obrazka
function addRow() {
    rowCount++;
    const hexCode = (0xE000 + rowCount).toString(16).toUpperCase();
    const div = document.createElement('div');
    div.className = 'item-row';
    div.id = `row-${rowCount}`;
    div.innerHTML = `
        <div style="display:flex; justify-content:space-between;">
            <span class="char-code">Kod w grze: \\u${hexCode}</span>
            <button class="btn-remove" onclick="document.getElementById('row-${rowCount}').remove()">X</button>
        </div>
        <div class="controls">
            <input type="file" class="file-input" accept="image/png">
            <label>Rozmiar:</label>
            <select class="size-input">
                <option value="16">16x16 (Ranga)</option>
                <option value="32">32x32 (Ikona)</option>
                <option value="128">128x128 (Logo)</option>
                <option value="256">256x256 (Wielkie)</option>
            </select>
            <input type="hidden" class="hex-val" value="\\u${hexCode}">
        </div>
    `;
    document.getElementById('items-list').appendChild(div);
}

// Przetwarzanie obrazu na Blob
async function processImage(file, size) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.getElementById('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = size;
                canvas.height = size;
                ctx.clearRect(0, 0, size, size);
                ctx.drawImage(img, 0, 0, size, size);
                canvas.toBlob(resolve, 'image/png');
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    });
}

// Główna funkcja budująca ZIP
async function buildPack() {
    const zip = new JSZip();
    const rows = document.querySelectorAll('.item-row');
    
    if (rows.length === 0) return alert("Dodaj przynajmniej jeden obrazek!");

    const providers = [];
    const fontFolder = zip.folder("assets/minecraft/textures/font");
    
    for (let i = 0; i < rows.length; i++) {
        const file = rows[i].querySelector('.file-input').files[0];
        const size = parseInt(rows[i].querySelector('.size-input').value);
        const charCode = rows[i].querySelector('.hex-val').value;
        const fileName = `icon_${i}.png`;

        if (file) {
            const blob = await processImage(file, size);
            fontFolder.file(fileName, blob);
            
            // Dodawanie wpisu do pliku fontów
            providers.push({
                "type": "bitmap",
                "file": `minecraft:font/${fileName}`,
                "ascent": 8,
                "height": 8, // Możesz zmienić na 'size/2' jeśli chcesz gigantyczne ikony
                "chars": [charCode]
            });
        }
    }

    // 1. pack.mcmeta
    zip.file("pack.mcmeta", JSON.stringify({
        "pack": { "pack_format": 34, "description": "Custom Font Icons" }
    }, null, 4));

    // 2. assets/minecraft/font/default.json
    zip.file("assets/minecraft/font/default.json", JSON.stringify({ "providers": providers }, null, 4));

    // 3. Generowanie i pobieranie
    const content = await zip.generateAsync({type:"blob"});
    saveAs(content, "Minecraft_Font_Pack.zip");
}

// Dodaj pierwszy wiersz na start
addRow();
</script>

</body>
</html>
